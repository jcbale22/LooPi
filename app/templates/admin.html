{% extends "base.html" %}

{% block title %}Admin Panel â€“ LooPi{% endblock %}

{% block content %}
<h1>LooPi Admin Panel</h1>

<!-- Flash Messages -->
{% if message %}
  <div class="message success">âœ… {{ message }}</div>
{% endif %}
{% if error %}
  <div class="message error">âŒ {{ error }}</div>
{% endif %}

<table>
  <thead>
    <tr>
      <th>Filename</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Preview</th>
      <th>Playlists</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for file in files %}
    <tr>
      <td>{{ file.filename }}</td>
      <td>{{ file.start }}</td>
      <td>{{ file.end }}</td>
      <td><img src="/uploads/{{ file.filename }}" style="height: 60px;" /></td>
      <td>
        {% for playlist in file.playlists %}
          <span class="pill pill-{{ playlist | lower | replace(' ', '-') }}">{{ playlist }}</span>
        {% endfor %}
      </td>
      <td>
        <form method="post" action="/update/">
          <input type="hidden" name="filename" value="{{ file.filename }}">

          <label for="start_{{ loop.index }}">Start:</label>
          <input type="date" name="start_date" value="{{ file.start }}" id="start_{{ loop.index }}">

          <label for="end_{{ loop.index }}">End:</label>
          <input type="date" name="end_date" value="{{ file.end }}" id="end_{{ loop.index }}">

          <br>

          <label for="playlists_{{ loop.index }}"><strong>Playlists:</strong></label>
          <select name="playlists" id="playlists_{{ loop.index }}" multiple size="3">
  {% for name in playlists.keys() %}
    <option value="{{ name }}" {% if name in file.playlists %}selected{% endif %}>
      {{ name }}
    </option>
  {% endfor %}
</select>


          <br><button type="submit" style="margin-top: 5px;">Update</button>
        </form>

        <form method="post" action="/delete/" class="delete-form">
          <input type="hidden" name="filename" value="{{ file.filename }}">
          <button type="submit">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<p style="margin-top: 16px;">
  <a href="/upload">â† Back to Upload Page</a> |
  <a href="/playlists">ğŸ¨ Manage Playlists</a>
</p>
{% endblock %}
